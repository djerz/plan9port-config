#!/bin/sh

# Wrapper around git to autoset GPG_TTY when running in a TTY

set -e

EXCLUDEDIRS=("$HOME/.acme/bin")

NOPWDPATH=$PATH
for d in $EXCLUDEDIRS; do
	NOPWDPATH=$(echo "$NOPWDPATH" | sed -e 's%:'"$d"'%%g')
	NOPWDPATH=$(echo "$NOPWDPATH" | sed -e 's%'"$d"':%%g')
done

GITBINPATH=$(PATH="$NOPWDPATH" command -v git)

if [ -z "$GITBINPATH" ]; then
	echo "No git binary available" 1>&2
	exit 1
fi

if [ -t 0 ]; then
	GPG_TTY=$(tty) $GITBINPATH "$@"
else
	$GITBINPATH "$@"
fi
